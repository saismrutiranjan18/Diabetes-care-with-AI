name: CI Validation Pipeline

on:
  issues:
    types: [opened, edited]
  pull_request:
    types: [opened, synchronize, reopened]
  push:
    branches: [main, develop]

jobs:
  # Job 1: Validate Issue Templates (Bug/Feature)
  validate-issue:
    if: github.event_name == 'issues'
    runs-on: ubuntu-latest
    steps:
      - name: Check for Bug or Feature Labels
        run: |
          echo "Reviewing issue: ${{ github.event.issue.title }}"
          # You can add custom scripts here to regex check issue body 
          # to ensure users didn't delete template sections.

  # Job 2: Linting and Testing (For PRs and Pushes)
  code-quality:
    if: github.event_name == 'pull_request' || github.event_name == 'push'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js (or your preferred language)
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install Dependencies
        run: npm install

      - name: Run Linting
        run: npm run lint

      - name: Run Automated Tests
        run: npm test

  # Job 3: Label-specific Logic
  label-check:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - name: Check Labels
        uses: actions/github-script@v7
        with:
          script: |
            const labels = context.payload.pull_request.labels.map(l => l.name);
            if (labels.includes('bug')) {
              console.log('Validating Bug Fix standards...');
            } else if (labels.includes('feature')) {
              console.log('Validating Feature Request standards...');
            }
